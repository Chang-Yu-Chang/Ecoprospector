---
title: "Pairwise competition using mechanistic consumer-resource models"
author: "Chang-Yu Chang"
date: "`r Sys.Date()`"
output:
  html_notebook:
    number_sections: no
    toc: yes
linkcolor: red
fontsize: 12pt
urlcolor: blue
---

```{r setup, include = FALSE}
# Knitr options
knitr::opts_chunk$set(
  cache = FALSE, 
  echo = FALSE,
	fig.align = "center",
	fig.height = 3,
	fig.width = 3)

# Packages
library(tidyverse)
library(data.table)
library(invnet)
library(reticulate) # Python interface
reticulate::use_python('~/anaconda3/bin/python3.7m') # Use this python version

# Local directory and functions
root <- rprojroot::is_r_package # Package root
source(root$find_file("misc/utils.R"))
source(root$find_file("misc/network_functions.R"))
write_all_csv <- TRUE
write_all_pdf <- TRUE

# Data
isolates <- fread(root$find_file("data/output/isolates.csv"))
pairs <- fread(root$find_file("data/output/pairs.csv"))
communities <- fread(root$find_file("data/temp/communities.csv"))
communities_name <- communities$Community
communities_size <- communities$CommunitySize
communities_name_pool <- c(paste0("C", 1:12, "Rpool"), paste0("C", rep(1:12, each = 8), "R", rep(1:8, 12)))
```

```{python}
import sys
print(sys.version)
```

# Settings

## Import packages

```{python echo = T}
from IPython.display import Image
from community_simulator import *
from community_simulator.usertools import *
from community_simulator.visualization import *
import seaborn as sns
import matplotlib.pyplot as plt
from matplotlib.backends import backend_pdf as bpdf
#colors = sns.color_palette()
#%matplotlib inline
```

## Load functions

Essential functions for community self-assembly

```{r}
# Source python script, like source() in R
```


# Community function and selection algorithm

## Community functions

**Consumers**

- Additive trait $\sum{\lambda_i n_i}$

- Complex trait $\sum{\lambda_i n_i} + \sum{\lambda_{ij} n_{ij}}$

- Additive trait with saturation $\sum{\frac{\lambda_i n_i}{n_i+k_i}}$

- Complex trait with saturation $\sum{\frac{\lambda_i n_i}{n_i+k_i}} + \sum{\frac{\lambda_{ij} n_{ij}}{n_i n _j+k_{ij}}}$


**Resources**

- Additive trait $\sum{\lambda_i R_i}$

- Complex trait $\sum{\lambda_i R_i} + \sum{\lambda_{ij} R_{ij}}$

- Additive trait with saturation $\sum{\frac{\lambda_i R_i}{R_i+k_i}}$

- Complex trait with saturation $\sum{\frac{\lambda_i R_i}{R_i+k_i}} + \sum{\frac{\lambda_{ij} R_{ij}}{R_i R_j+k_{ij}}}$


## Selection algorithms

Students will work on putting together what literature has proposed

The proposed algorithm using perturbated migration

1. Find the best

2. Let it propagate to equilibrium

3. Keep it

4. Perturbate it by migration


# Simulation regions

210 speices in the universe of simulation

96 wells/replicate community

10 metacommunities, within which there are 96 species pools (soil samples) that has different power-law distribution for 210 species

8 community functions

10 selection algorithms

Run 4 replicate for each of the combinations

In total the number of wells is 

```{r}
(10*8*10*4*96)
```






